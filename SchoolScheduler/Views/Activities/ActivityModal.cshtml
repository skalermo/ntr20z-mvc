@model Activity

@{
    string modalTitle = ViewBag.idx != -1 ? "Edit Activity" : "Add New Activity";
}
<div class="modal-dialog" role="document">
    <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">@modalTitle</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>

    @using (Html.BeginForm("ModalAction", "Activities", FormMethod.Post))
    {
            <div class="modal-body">
                <div class="form-group row">
                    <label for="room" class="col-sm-2 col-form-label">Room</label>
                    <div class="col-sm-10">

                        <select name="room" @(ViewBag.selectedOption == OptionEnum.Rooms ? "disabled" :
                                "")>
                            @if (ViewBag.idx == -1 && ViewBag.selectedOption != OptionEnum.Rooms)
                            {
                                <option value="" disabled selected>Select a room</option>

                            }
                                @foreach (var room in ViewBag.rooms)
                            {

                                if (ViewBag.idx != -1 && room == Model.Room)
                                {
                                            <option value="@room" selected>@room</option>
                                }
                                else if (ViewBag.idx == -1 && ViewBag.selectedOption == OptionEnum.Rooms){
                                            <option value="@ViewBag.selectedValue">@ViewBag.selectedValue</option>
                                }
                                else {
                                            <option value="@room">@room</option>
                                }
                            }

                                        </select>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="group" class="col-sm-2 col-form-label">Group</label>
                                    <div class="col-sm-10">

                                        <select name="group" @(ViewBag.selectedOption == OptionEnum.Groups ? "disabled" : "")>
                                           @if (ViewBag.idx == -1 && ViewBag.selectedOption != OptionEnum.Groups)
                            {
                                        <option value="" disabled selected>Select a group</option>

                            }
                                        @foreach (var group in ViewBag.groups)
                            {
                                if (ViewBag.idx != -1 && group == Model.Group)
                                {
                                            <option value="@group" selected>@group</option>
                                }
                                else if (ViewBag.idx == -1 && ViewBag.selectedOption == OptionEnum.Groups){
                                            <option value="@ViewBag.selectedValue">@ViewBag.selectedValue</option>
                                }
                                else {
                                            <option value="@group">@group</option>
                                }
                            }
                                        </select>

                                    </div>
                                </div>

                                <div class="form-group row">
                                    <label for="class_" class="col-sm-2 col-form-label">Class</label>
                                    <div class="col-sm-10">

                                        <select name="class_">
                                            @if (ViewBag.idx == -1)
                            {
                                        <option value="" disabled selected>Select a class</option>

                            }
                                        @foreach (var class_ in ViewBag.classes)
                            {
                                if (class_ == Model.Class && ViewBag.idx != -1)
                                {
                                            <option value="@class_" selected>@class_</option>
                                }
                                else {
                                            <option value="@class_">@class_</option>
                                }
                            }
                                        </select>

                                    </div>
                                </div>

                                <div class="form-group row">
                                    <label for="teacher" class="col-sm-2 col-form-label">Teacher</label>
                                    <div class="col-sm-10">


                                        <select name="teacher" @(ViewBag.selectedOption == OptionEnum.Teachers ? "disabled" : "")>
                                            @if (ViewBag.idx == -1 && ViewBag.selectedOption != OptionEnum.Teachers)
                            {
                                        <option value="" disabled selected>Select a teacher</option>

                            }
                                        @foreach (var teacher in ViewBag.teachers)
                            {
                                if (ViewBag.idx != -1 && teacher == Model.Teacher)
                                {
                                            <option value="@teacher" selected>@teacher</option>
                                }
                                else if (ViewBag.idx == -1 && ViewBag.selectedOption == OptionEnum.Teachers){
                                            <option value="@ViewBag.selectedValue">@ViewBag.selectedValue</option>
                                }
                                else {
                                            <option value="@teacher">@teacher</option>
                                }
                            }
                                        </select>

                                    </div>
                                </div>

                            </div>

                                <input type="hidden" name="selectedOption" value=@ViewBag.selectedOption />
                                <input type="hidden" name="selectedValue" value=@ViewBag.selectedValue />
                                <input type="hidden" name="idx" value=@ViewBag.idx />
                                <input type="hidden" name="slot" value="@Model.Slot" />

                            <div class="modal-footer">
                                <input type="submit" name="deleteButton" value="Delete" class="btn btn-secondary" @(ViewBag.idx == -1 ? "disabled" : "")>
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                <input type="submit" name="saveButton" id="saveButton" value="Save" class="btn btn-primary" disabled="disabled">
                            </div>
    }
                    </div>
                </div>


<script type="text/javascript">
    $('form').submit(function(e) {
        $(':disabled').each(function(e) {
            $(this).removeAttr('disabled');
        })
    });

    (function() {
        $('select').change(function() {

            var empty = false;
            $('select').each(function() {
                if ($(this).val().startsWith('Select')) {
                    empty = true;
                }
            });

            if (empty) {
                $('#saveButton').attr('disabled', 'disabled');
            } else {
                $('#saveButton').removeAttr('disabled');
            }
        });
    })()
</script>